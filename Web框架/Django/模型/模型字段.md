---
title: 模型字段
description: 
published: true
date: 2021-03-21T16:46:50.655Z
tags: django
editor: markdown
dateCreated: 2021-02-24T02:43:11.974Z
---

# Django 中的 ORM

```diagram
PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSIzODUiIGhlaWdodD0iMjI0IiB2aWV3Qm94PSItMC41IC0wLjUgMzg1IDIyNCIgY29udGVudD0iJmx0O214ZmlsZSBob3N0PSZxdW90O2VtYmVkLmRpYWdyYW1zLm5ldCZxdW90OyBtb2RpZmllZD0mcXVvdDsyMDIxLTAyLTI3VDA4OjAyOjM3Ljg3M1omcXVvdDsgYWdlbnQ9JnF1b3Q7NS4wIChYMTE7IExpbnV4IHg4Nl82NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzg4LjAuNDMyNC4xODIgU2FmYXJpLzUzNy4zNiZxdW90OyB2ZXJzaW9uPSZxdW90OzE0LjQuMiZxdW90OyBldGFnPSZxdW90O3ExMUtVaWQ5X1FRN1pMZDZLdktMJnF1b3Q7IHR5cGU9JnF1b3Q7ZW1iZWQmcXVvdDsmZ3Q7Jmx0O2RpYWdyYW0gaWQ9JnF1b3Q7RFlFbWladksyTHZmNGhUWWhsdXomcXVvdDsgbmFtZT0mcXVvdDtQYWdlLTEmcXVvdDsmZ3Q7NVpqTGNwc3dGSWFmUnR1T1FPYTJCSXpiUlRPZGFSWk5sd3FTUWEyTVBFS083VDU5SlNNQ0dOekp4STR6Y1RjZXpxK0x4ZmNmbndNR0tGM3RQa3U4THU4RW9SeTRrT3dBbWdQWERWeW9QNDJ3YndUUGR4dWhrSXcwRXV5RWUvYUhOcUxUcWh0R2FHMjFSbEpDY01YV1F6RVhWVVZ6TmRDd2xHSTduTFlVbkF5RU5TN280QmhHdU04eHA2TnBQeGhSWmFPR2J0RHBYeWdyeXZhYkhUOXFSbGE0bld3M3JrdE14TGEzSzhvQVNxVVFxcmxhN1ZMS0Ric2hsOFdKMGVlRFNWcXBseXl3M0o4dzM5aDdzK2RTKy9abXBkaFVoSnI1RGtESnRtU0szcTl4YmthMzJsMnRsV3JGN2ZDU2NaNEtMdVJoTFNLWWhzdGM2N1dTNGpmdGpmaDVTQitYZXNRZWdFcEZkeWR2b2tPalU0cUtGVlZ5cjZmWUJaSGZyTERaNUxRN2JIdmUyQ2xsenhZOTBhYUVUWWZpZWVlT21MNncwS1lCb2hIQWI5L3ZSZ3oxdmFraHFDR1FTbFQwaUo2Vk1HZEZwY05jczZCYVR3d3BwbE14dGdNclJvajVta2xuT3UrZzJWNVV5djZZWEtlTjdTR2RDL2pnT05IUUNJUkdSc3pnaEJId2ZCOW00MFRPQXBBNElFbk96T2dPbWpNYlp6aUVhZXI3cHd5OUJGUVlmdktHV0lOZ2hOVjN4bGlSZno1V2J3S3JCK0lGU0NLUWhZWnY3TndhWDExUXJzYlhuK1Nyc1VZWnlId1FRaEFITjhjM2hGZmpHN3h0ZjFzdXFaOVA5amNTUkk4UVhnWWhDdEg3TmJod1JIQStycWovUjMrYndhTUhqU3YydDJpaVVJU20rTWJobTlhSHhTS0VoengrcS9xQUl1OGQrMXY3UmpIbUdxYTN4dldhZmMxeEpyanFCNGM1aUFMVDJPSU1KTjdOQWI1aVkydExlNDhlSmZvbDFZWkNxbElVb3NJODY5U2pjdG5OK1NyRTJsTDlSWlhhVzZ4NG84U1FPZDB4OWRDNy9tbTIwaFNhYUw2ek94K0NmUnRVK3RZZStrRnZsUW03Wlllb1hYZnNiNjJ3VkxGNWV6ZnRndU82Wm5rckx4aHZqMGh3WFQ2blVNUElnUG0zeVpxajJNamN6ckx2RW5yamdxcGUrUjJuZ3FRY0svWTAzUDBzVzlGSHNYWEErWVhlSEZ2Nk9udThzVDFOR2IrR1A3T1A0czlyZjNidjU2cy80ZXVKRW55dXJ6cnMvbU03alBYK3FFVFpYdz09Jmx0Oy9kaWFncmFtJmd0OyZsdDsvbXhmaWxlJmd0OyI+PGRlZnM+PGZpbHRlciBpZD0iZHJvcFNoYWRvdyI+PGZlR2F1c3NpYW5CbHVyIGluPSJTb3VyY2VBbHBoYSIgc3RkRGV2aWF0aW9uPSIxLjciIHJlc3VsdD0iYmx1ciIvPjxmZU9mZnNldCBpbj0iYmx1ciIgZHg9IjMiIGR5PSIzIiByZXN1bHQ9Im9mZnNldEJsdXIiLz48ZmVGbG9vZCBmbG9vZC1jb2xvcj0iIzNENDU3NCIgZmxvb2Qtb3BhY2l0eT0iMC40IiByZXN1bHQ9Im9mZnNldENvbG9yIi8+PGZlQ29tcG9zaXRlIGluPSJvZmZzZXRDb2xvciIgaW4yPSJvZmZzZXRCbHVyIiBvcGVyYXRvcj0iaW4iIHJlc3VsdD0ib2Zmc2V0Qmx1ciIvPjxmZUJsZW5kIGluPSJTb3VyY2VHcmFwaGljIiBpbjI9Im9mZnNldEJsdXIiLz48L2ZpbHRlcj48L2RlZnM+PGcgZmlsdGVyPSJ1cmwoI2Ryb3BTaGFkb3cpIj48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iODYiIGhlaWdodD0iMjEyIiByeD0iMTIuOSIgcnk9IjEyLjkiIGZpbGw9IiNkYWU4ZmMiIHN0cm9rZT0iIzZjOGViZiIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxyZWN0IHg9IjIzIiB5PSIxMiIgd2lkdGg9IjQwIiBoZWlnaHQ9IjIwIiBmaWxsPSJub25lIiBzdHJva2U9Im5vbmUiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj48c3dpdGNoPjxmb3JlaWduT2JqZWN0IHN0eWxlPSJvdmVyZmxvdzogdmlzaWJsZTsgdGV4dC1hbGlnbjogbGVmdDsiIHBvaW50ZXItZXZlbnRzPSJub25lIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiPjxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogdW5zYWZlIGNlbnRlcjsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgY2VudGVyOyB3aWR0aDogMzhweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiAyMnB4OyBtYXJnaW4tbGVmdDogMjRweDsiPjxkaXYgc3R5bGU9ImJveC1zaXppbmc6IGJvcmRlci1ib3g7IGZvbnQtc2l6ZTogMDsgdGV4dC1hbGlnbjogY2VudGVyOyAiPjxkaXYgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jazsgZm9udC1zaXplOiAyMXB4OyBmb250LWZhbWlseTogSGVsdmV0aWNhOyBjb2xvcjogIzAwMDAwMDsgbGluZS1oZWlnaHQ6IDEuMjsgcG9pbnRlci1ldmVudHM6IGFsbDsgZm9udC13ZWlnaHQ6IGJvbGQ7IHdoaXRlLXNwYWNlOiBub3JtYWw7IHdvcmQtd3JhcDogbm9ybWFsOyAiPk9STTwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSI0MyIgeT0iMjgiIGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMjFweCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC13ZWlnaHQ9ImJvbGQiPk9STTwvdGV4dD48L3N3aXRjaD48L2c+PHJlY3QgeD0iMTIuNSIgeT0iNTYiIHdpZHRoPSI2MSIgaGVpZ2h0PSIzNiIgcng9IjUuNCIgcnk9IjUuNCIgZmlsbD0iIzAwY2M2NiIgc3Ryb2tlPSJub25lIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+PHN3aXRjaD48Zm9yZWlnbk9iamVjdCBzdHlsZT0ib3ZlcmZsb3c6IHZpc2libGU7IHRleHQtYWxpZ246IGxlZnQ7IiBwb2ludGVyLWV2ZW50cz0ibm9uZSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5Ij48ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IHVuc2FmZSBjZW50ZXI7IGp1c3RpZnktY29udGVudDogdW5zYWZlIGNlbnRlcjsgd2lkdGg6IDU5cHg7IGhlaWdodDogMXB4OyBwYWRkaW5nLXRvcDogNzRweDsgbWFyZ2luLWxlZnQ6IDE0cHg7Ij48ZGl2IHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDA7IHRleHQtYWxpZ246IGNlbnRlcjsgIj48ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMTRweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6ICMwMDAwMDA7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IHdvcmQtd3JhcDogbm9ybWFsOyAiPuexuzwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSI0MyIgeT0iNzgiIGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTRweCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+57G7PC90ZXh0Pjwvc3dpdGNoPjwvZz48cmVjdCB4PSIxMi41IiB5PSIxMDgiIHdpZHRoPSI2MSIgaGVpZ2h0PSIzNiIgcng9IjUuNCIgcnk9IjUuNCIgZmlsbD0iIzAwY2M2NiIgc3Ryb2tlPSJub25lIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+PHN3aXRjaD48Zm9yZWlnbk9iamVjdCBzdHlsZT0ib3ZlcmZsb3c6IHZpc2libGU7IHRleHQtYWxpZ246IGxlZnQ7IiBwb2ludGVyLWV2ZW50cz0ibm9uZSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5Ij48ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IHVuc2FmZSBjZW50ZXI7IGp1c3RpZnktY29udGVudDogdW5zYWZlIGNlbnRlcjsgd2lkdGg6IDU5cHg7IGhlaWdodDogMXB4OyBwYWRkaW5nLXRvcDogMTI2cHg7IG1hcmdpbi1sZWZ0OiAxNHB4OyI+PGRpdiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwOyB0ZXh0LWFsaWduOiBjZW50ZXI7ICI+PGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDE0cHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiAjMDAwMDAwOyBsaW5lLWhlaWdodDogMS4yOyBwb2ludGVyLWV2ZW50czogYWxsOyB3aGl0ZS1zcGFjZTogbm9ybWFsOyB3b3JkLXdyYXA6IG5vcm1hbDsgIj7lr7nosaE8L2Rpdj48L2Rpdj48L2Rpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgeD0iNDMiIHk9IjEzMCIgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxNHB4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7lr7nosaE8L3RleHQ+PC9zd2l0Y2g+PC9nPjxyZWN0IHg9IjEyLjUiIHk9IjE1OSIgd2lkdGg9IjYxIiBoZWlnaHQ9IjM2IiByeD0iNS40IiByeT0iNS40IiBmaWxsPSIjMDBjYzY2IiBzdHJva2U9Im5vbmUiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj48c3dpdGNoPjxmb3JlaWduT2JqZWN0IHN0eWxlPSJvdmVyZmxvdzogdmlzaWJsZTsgdGV4dC1hbGlnbjogbGVmdDsiIHBvaW50ZXItZXZlbnRzPSJub25lIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiPjxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogdW5zYWZlIGNlbnRlcjsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgY2VudGVyOyB3aWR0aDogNTlweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiAxNzdweDsgbWFyZ2luLWxlZnQ6IDE0cHg7Ij48ZGl2IHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDA7IHRleHQtYWxpZ246IGNlbnRlcjsgIj48ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMTRweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6ICMwMDAwMDA7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IHdvcmQtd3JhcDogbm9ybWFsOyAiPuWxnuaApzwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSI0MyIgeT0iMTgxIiBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjE0cHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPuWxnuaApzwvdGV4dD48L3N3aXRjaD48L2c+PHJlY3QgeD0iMjg3IiB5PSIwIiB3aWR0aD0iODYiIGhlaWdodD0iMjEyIiByeD0iMTIuOSIgcnk9IjEyLjkiIGZpbGw9IiNmZmU2Y2MiIHN0cm9rZT0iI2Q3OWIwMCIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxyZWN0IHg9IjMxMCIgeT0iMTIiIHdpZHRoPSI0MCIgaGVpZ2h0PSIyMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJub25lIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+PHN3aXRjaD48Zm9yZWlnbk9iamVjdCBzdHlsZT0ib3ZlcmZsb3c6IHZpc2libGU7IHRleHQtYWxpZ246IGxlZnQ7IiBwb2ludGVyLWV2ZW50cz0ibm9uZSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5Ij48ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IHVuc2FmZSBjZW50ZXI7IGp1c3RpZnktY29udGVudDogdW5zYWZlIGNlbnRlcjsgd2lkdGg6IDM4cHg7IGhlaWdodDogMXB4OyBwYWRkaW5nLXRvcDogMjJweDsgbWFyZ2luLWxlZnQ6IDMxMXB4OyI+PGRpdiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwOyB0ZXh0LWFsaWduOiBjZW50ZXI7ICI+PGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDIxcHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiAjMDAwMDAwOyBsaW5lLWhlaWdodDogMS4yOyBwb2ludGVyLWV2ZW50czogYWxsOyBmb250LXdlaWdodDogYm9sZDsgd2hpdGUtc3BhY2U6IG5vcm1hbDsgd29yZC13cmFwOiBub3JtYWw7ICI+REI8L2Rpdj48L2Rpdj48L2Rpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgeD0iMzMwIiB5PSIyOCIgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIyMXB4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXdlaWdodD0iYm9sZCI+REI8L3RleHQ+PC9zd2l0Y2g+PC9nPjxyZWN0IHg9IjI5OS41IiB5PSI1NiIgd2lkdGg9IjYxIiBoZWlnaHQ9IjM2IiByeD0iNS40IiByeT0iNS40IiBmaWxsPSIjZmY4MDAwIiBzdHJva2U9Im5vbmUiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj48c3dpdGNoPjxmb3JlaWduT2JqZWN0IHN0eWxlPSJvdmVyZmxvdzogdmlzaWJsZTsgdGV4dC1hbGlnbjogbGVmdDsiIHBvaW50ZXItZXZlbnRzPSJub25lIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiPjxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogdW5zYWZlIGNlbnRlcjsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgY2VudGVyOyB3aWR0aDogNTlweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiA3NHB4OyBtYXJnaW4tbGVmdDogMzAxcHg7Ij48ZGl2IHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDA7IHRleHQtYWxpZ246IGNlbnRlcjsgIj48ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMTRweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6ICMwMDAwMDA7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IHdvcmQtd3JhcDogbm9ybWFsOyAiPuihqDwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSIzMzAiIHk9Ijc4IiBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjE0cHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPuihqDwvdGV4dD48L3N3aXRjaD48L2c+PHJlY3QgeD0iMjk5LjUiIHk9IjEwOCIgd2lkdGg9IjYxIiBoZWlnaHQ9IjM2IiByeD0iNS40IiByeT0iNS40IiBmaWxsPSIjZmY4MDAwIiBzdHJva2U9Im5vbmUiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj48c3dpdGNoPjxmb3JlaWduT2JqZWN0IHN0eWxlPSJvdmVyZmxvdzogdmlzaWJsZTsgdGV4dC1hbGlnbjogbGVmdDsiIHBvaW50ZXItZXZlbnRzPSJub25lIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiPjxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogdW5zYWZlIGNlbnRlcjsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgY2VudGVyOyB3aWR0aDogNTlweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiAxMjZweDsgbWFyZ2luLWxlZnQ6IDMwMXB4OyI+PGRpdiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwOyB0ZXh0LWFsaWduOiBjZW50ZXI7ICI+PGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDE0cHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiAjMDAwMDAwOyBsaW5lLWhlaWdodDogMS4yOyBwb2ludGVyLWV2ZW50czogYWxsOyB3aGl0ZS1zcGFjZTogbm9ybWFsOyB3b3JkLXdyYXA6IG5vcm1hbDsgIj7ooYw8L2Rpdj48L2Rpdj48L2Rpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgeD0iMzMwIiB5PSIxMzAiIGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTRweCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+6KGMPC90ZXh0Pjwvc3dpdGNoPjwvZz48cmVjdCB4PSIyOTkuNSIgeT0iMTU5IiB3aWR0aD0iNjEiIGhlaWdodD0iMzYiIHJ4PSI1LjQiIHJ5PSI1LjQiIGZpbGw9IiNmZjgwMDAiIHN0cm9rZT0ibm9uZSIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPjxzd2l0Y2g+PGZvcmVpZ25PYmplY3Qgc3R5bGU9Im92ZXJmbG93OiB2aXNpYmxlOyB0ZXh0LWFsaWduOiBsZWZ0OyIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSI+PGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiB1bnNhZmUgY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IHVuc2FmZSBjZW50ZXI7IHdpZHRoOiA1OXB4OyBoZWlnaHQ6IDFweDsgcGFkZGluZy10b3A6IDE3N3B4OyBtYXJnaW4tbGVmdDogMzAxcHg7Ij48ZGl2IHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDA7IHRleHQtYWxpZ246IGNlbnRlcjsgIj48ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMTRweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6ICMwMDAwMDA7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IHdvcmQtd3JhcDogbm9ybWFsOyAiPuWtl+autTwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSIzMzAiIHk9IjE4MSIgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxNHB4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7lrZfmrrU8L3RleHQ+PC9zd2l0Y2g+PC9nPjxwYXRoIGQ9Ik0gNzkuODcgNzQgTCAyOTMuMTMgNzQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMDAwMCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2UtZGFzaGFycmF5PSIzIDMiIHBvaW50ZXItZXZlbnRzPSJzdHJva2UiLz48cGF0aCBkPSJNIDc0LjYyIDc0IEwgODEuNjIgNzAuNSBMIDc5Ljg3IDc0IEwgODEuNjIgNzcuNSBaIiBmaWxsPSIjMDAwMDAwIiBzdHJva2U9IiMwMDAwMDAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxwYXRoIGQ9Ik0gMjk4LjM4IDc0IEwgMjkxLjM4IDc3LjUgTCAyOTMuMTMgNzQgTCAyOTEuMzggNzAuNSBaIiBmaWxsPSIjMDAwMDAwIiBzdHJva2U9IiMwMDAwMDAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxwYXRoIGQ9Ik0gNzkuODcgMTI2IEwgMjkzLjEzIDEyNiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwMDAwIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS1kYXNoYXJyYXk9IjMgMyIgcG9pbnRlci1ldmVudHM9InN0cm9rZSIvPjxwYXRoIGQ9Ik0gNzQuNjIgMTI2IEwgODEuNjIgMTIyLjUgTCA3OS44NyAxMjYgTCA4MS42MiAxMjkuNSBaIiBmaWxsPSIjMDAwMDAwIiBzdHJva2U9IiMwMDAwMDAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxwYXRoIGQ9Ik0gMjk4LjM4IDEyNiBMIDI5MS4zOCAxMjkuNSBMIDI5My4xMyAxMjYgTCAyOTEuMzggMTIyLjUgWiIgZmlsbD0iIzAwMDAwMCIgc3Ryb2tlPSIjMDAwMDAwIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48cGF0aCBkPSJNIDc5Ljg3IDE3NyBMIDI5My4xMyAxNzciIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMDAwMCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2UtZGFzaGFycmF5PSIzIDMiIHBvaW50ZXItZXZlbnRzPSJzdHJva2UiLz48cGF0aCBkPSJNIDc0LjYyIDE3NyBMIDgxLjYyIDE3My41IEwgNzkuODcgMTc3IEwgODEuNjIgMTgwLjUgWiIgZmlsbD0iIzAwMDAwMCIgc3Ryb2tlPSIjMDAwMDAwIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48cGF0aCBkPSJNIDI5OC4zOCAxNzcgTCAyOTEuMzggMTgwLjUgTCAyOTMuMTMgMTc3IEwgMjkxLjM4IDE3My41IFoiIGZpbGw9IiMwMDAwMDAiIHN0cm9rZT0iIzAwMDAwMCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PC9nPjxzd2l0Y2g+PGcgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5Ii8+PGEgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwtNSkiIHhsaW5rOmhyZWY9Imh0dHBzOi8vd3d3LmRpYWdyYW1zLm5ldC9kb2MvZmFxL3N2Zy1leHBvcnQtdGV4dC1wcm9ibGVtcyIgdGFyZ2V0PSJfYmxhbmsiPjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtc2l6ZT0iMTBweCIgeD0iNTAlIiB5PSIxMDAlIj5WaWV3ZXIgZG9lcyBub3Qgc3VwcG9ydCBmdWxsIFNWRyAxLjE8L3RleHQ+PC9hPjwvc3dpdGNoPjwvc3ZnPg==
```

- 模型：相当于 Python 的类，映射一张数据库表。继承自 `django.db.models.Model`
- 属性：相当于一个数据库的字段，映射为一个数据库列。`Field` 类的实例

例如下面的模型：

```python
from django.db import models

class Person(models.Model):
    name = models.CharField(max_length=200)
    email = models.EmailField()
```

采用 MySQL 8.0 数据库引擎，其对应的创建表的 SQL 语句如下：

```sql
CREATE TABLE `app02_person` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(200) NOT NULL,
  `email` varchar(254) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8
```

表结构如下：

```sql
mysql> desc app02_person;
+-------+--------------+------+-----+---------+----------------+
| Field | Type         | Null | Key | Default | Extra          |
+-------+--------------+------+-----+---------+----------------+
| id    | int          | NO   | PRI | NULL    | auto_increment |
| name  | varchar(200) | NO   |     | NULL    |                |
| email | varchar(254) | NO   |     | NULL    |                |
+-------+--------------+------+-----+---------+----------------+
3 rows in set (0.01 sec)
```

# 字段名称的限制

- 不能是 Python 保留字

```python
class Example(models.Model):
    pass = models.IntegerField()  # “pass”是保留字！
```

- 字段名称不能包含多个连续的下划线，否则会影响 Django 的查询查找句法

```python
class Example(models.Model):
    # “foo__bar”中有两个下划线！
    foo__bar = models.IntegerField()
```

- 字段名不能以下划线结尾

# 字段类型

> [字段类型参考文档](https://docs.djangoproject.com/zh-hans/3.1/ref/models/fields/#model-field-types)
{.is-success}

模型中每一个字段都是某个 Field 类的实例，Django 利用这些字段类来实现以下功能：

- 字段类型用以指定数据库数据类型
- 在渲染表单字段时默认使用的 HTML 视图 (如： `<input type="text">, <select>`)。
- 基本的有效性验证功能，用于 Django 后台和自动生成的表单。

```python
class ALLFieldType(models.Model):
    # AutoFiled
    id = models.AutoField(primary_key=True)
    # smallAutoField = models.SmallAutoField()  # Django 3.0
    # bigAutoField = models.BigAutoField()

    # IntegerField
    integerField = models.IntegerField()
    smallIntegerField = models.SmallIntegerField()
    bigIntegerField = models.BigIntegerField()

    # PositiveIntegerField
    positiveIntegerField = models.PositiveIntegerField()
    positiveSmallIntegerField = models.PositiveSmallIntegerField()
    positiveBigIntegerField = models.PositiveBigIntegerField()

    # datetime / time
    timeField = models.TimeField()
    dateTime = models.DateTimeField()
    dateField = models.DateField()
    durationField = models.DurationField()

    # char / text
    charField = models.CharField(max_length=20)
    textField = models.TextField()

    # file
    fileField = models.FileField()
    filePathField = models.FilePathField()
    imageField = models.ImageField()

    # float
    decimalField = models.DecimalField(max_digits=5, decimal_places=3)
    floatField = models.FloatField()

    # boolean
    # nullBooleanField = models.NullBooleanField() # 3.1 版后已移除
    booleanField = models.BooleanField()

    #
    binaryField = models.BinaryField()
    emailField = models.EmailField()
    urlField = models.URLField()
    uuidField = models.UUIDField()
    genericIpAddressField = models.GenericIPAddressField()
    jsonField = models.JSONField()
    slugField = models.SlugField()

    # 关系字段:
    # ForeignKey / ManyToManyField / OneToOneField
```


```sql
create table myapp_allfieldtype
(
    id                        int auto_increment primary key,
    integerField              int               not null,
    smallIntegerField         smallint          not null,
    bigIntegerField           bigint            not null,
    positiveIntegerField      int unsigned      not null,
    positiveSmallIntegerField smallint unsigned not null,
    positiveBigIntegerField   bigint unsigned   not null,
    timeField                 time(6)           not null,
    dateTime                  datetime(6)       not null,
    dateField                 date              not null,
    durationField             bigint            not null,
    charField                 varchar(20)       not null,
    textField                 longtext          not null,
    fileField                 varchar(100)      not null,
    filePathField             varchar(100)      not null,
    imageField                varchar(100)      not null,
    decimalField              decimal(5, 3)     not null,
    floatField                double            not null,
    booleanField              tinyint(1)        not null,
    binaryField               longblob          not null,
    emailField                varchar(254)      not null,
    urlField                  varchar(200)      not null,
    uuidField                 char(32)          not null,
    genericIpAddressField     char(39)          not null,
    jsonField                 json              not null,
    slugField                 varchar(50)       not null
);
```

| 字段类型                    | 数据库类型                | 描述                                                         |
| --------------------------- | ------------------------- | ------------------------------------------------------------ |
| `AutoField`                 | `int auto_increment`      | 32 位整数自增，默认自增主键                                  |
| `SmallAutoField`            | `smallint auto_increment` | 16 位整数自增，1 到 32767 的值                               |
| `BigAutoField`              | `bigint auto_increment`   | 64 位整数自增，1 到 9223372036854775807                      |
| `SmallIntegerField`         | `smallint `               | 16 位整数，-32768 到 32767的值                               |
| `IntegerField`              | `int`                     | 32 位整数。-2147483648 到 2147483647 的值                    |
| `BigIntegerField`           | `bigint`                  | 64 位整数。-9223372036854775808 到 9223372036854775807 的数字 |
| `PositiveSmallIntegerField` | `int unsigned `           | 0 到 32767 的值                                              |
| `PositiveIntegerField`      | `smallint unsigned`       | 0 到 2147483647 的值                                         |
| `PositiveBigIntegerField`   | `bigint unsigned`         | 0 到 223372036854775807 的值                                 |
| `TimeField`                 | `time(6) `                | 时间，在 Python 中用 `datetime.time` 实例表示<br>默认的表单部件是一个`TimeInput` |
| `DateTimeField`             | `datetime(6)`             | 日期和时间，在 Python 中用一个 `datetime.datetime` 实例表示<br>默认表单部件是一个单独的 `DateTimeInput` |
| `DateField`                 | `date`                    | 日期，在 Python 中用一个 `datetime.date` 实例表示            |
| `DurationField`             | `bigint`                  | 用于存储时间段的字段，在 Python 中用 `timedelta`建模         |
| `CharField(max_length)`     | `varchar(20) `            | 字符串字段。默认表单部件是一个`TextInput`                    |
| `TextField`                 | `longtext`                | 大的文本字段。该字段的默认表单部件是一个 `Textarea`          |
| `FileField`                 | `varchar(100) `           | 文件上传字段                                                 |
| `FilePathField`             | `varchar(100)`            | 一个`CharField`，限定只能在文件系统中的特定目录里选择文件    |
| `ImageField`                | `varchar(100)`            | 继承`FileField`的所有属性和方法，此外验证上传的对象是不是有效的图像。增加了 height 和 width 两个属性。需要 Pillow 库支持 |
| `DecimalField`              | `decimal `                | 固定精度的小数，在 Python 中使用 Decimal 实例表示。有两个必须的参数：max_digits 和 decimal_places |
| `FloatField`                | `double`                  | 在 Python 中用一个 `float` 实例表示，注意，`field.localize` 的值为 False 时，默认的小组件是 `TextInput` |
| `BooleanField`              | `tinyint(1)`              | `true / false` 字段，该字段的默认表单部件是 `CheckboxInput`  |
| `BinaryField`               | `longblob`                | 用于存储原始二进制数据的字段                                 |
| `EmailField`                | `varchar(254)`            | 是否为有效的电子邮件地址                                     |
| `URLField`                  | `varchar(200)`            | 该字段的默认表单部件是一个`URLInput`                         |
| `UUIDField`                 | `char(32)`                | 存储通用唯一标识符的字段。使用 Python 的 [`UUID`](https://docs.python.org/3/library/uuid.html#uuid.UUID) 类 |
| `GenericIPAddressField`     | `char(39)`                | `IPv4` 或 `IPv6` 地址，字符串形式（如 192.0.2.30、2a02:42fe::4） |
| `SlugField`                 | `varchar(50)`             | 简短的标签，只包含字母、数字、下划线或连字符                 |
| `JSONField(Django 3.1)`     | `json`                    | 存储 JSON 编码数据的字段                                     |

# ForeignKey

ForeignKey 表示多对一的关系。需要两个位置参数：模型相关的类和 on_delete 选项。

## 自关联

```python
models.ForeignKey('self', on_delete=models.CASCADE)
```

例如下面处于同一个 `app01` 应用的 User 模型和 Group 模型，表示多个 User 存在一个 Group。

```python
class User(models.Model):
    name = models.CharField(max_length=20)
    # Group 尚未定义，使用名称而不是模型对象本身
    user = models.ForeignKey('Group', on_delete=models.CASCADE)

class Group(models.Model):
    title = models.CharField(max_length=20)
```

上述的模型对应 MySQL 的 SQL 建表语句如下：

```sql
CREATE TABLE `app01_user` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(20) NOT NULL,
  `group_id` int NOT NULL,
  PRIMARY KEY (`id`),
  KEY `app01_user_group_id_38b03a6e_fk_app01_group_id` (`group_id`),
  CONSTRAINT `app01_user_group_id_38b03a6e_fk_app01_group_id` FOREIGN KEY (`group_id`) REFERENCES `app01_group` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8

CREATE TABLE `app01_group` (
  `id` int NOT NULL AUTO_INCREMENT,
  `title` varchar(20) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8
```

> 默认情况下，`ForeignKey` 命名为 `字段名_id`，且会自动创建一个数据库索引。你可以通过设置 `db_index` 为 False 来禁用它。
{.is-info}


如果上面的 Group 模型是在另一个叫做 `app02` 的应用程序中定义的，你需要使用 `app02.Group` 指明关联模型类

```sql
class User(models.Model):
    name = models.CharField(max_length=20)
    group = models.ForeignKey('app02.Group', on_delete=models.CASCADE)
```

这种被称为**懒惰关系**的引用，在解决两个应用程序之间的循环导入依赖关系时很有用。

## [on_delete](https://docs.djangoproject.com/zh-hans/3.1/ref/models/fields/#arguments)

该参数用于控制由 ForeignKey 引用的对象被删除时，将模拟对应 SQL 约束的行为。

其可能的取值为：

| 值                                                           | 描述                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| `CASCADE`                                                    | 级联删除。Django 模拟了 SQL 约束 `ON DELETE CASCADE` 的行为，也删除了包含 ForeignKey 的对象。 |
| `PROTECT`                                                    | 通过引发 `ProtectedError`，即 `django.db.IntegrityError` 的子类，防止删除被引用对象。 |
| [`RESTRICT`](https://docs.djangoproject.com/zh-hans/3.1/ref/models/fields/#django.db.models.RESTRICT) | Django 3.1 支持                                              |
| `SET_NULL`                                                   | 设置 ForeignKey 为空，前提是 `null = True`。                 |
| `SET_DEFAULT`                                                | 将 ForeignKey 设置为默认值，前提是设置 `Default` 参数        |
| `SET()`                                                      | 将 ForeignKey 设置为传递给 `SET()` 的值，如果传递了一个可调用的值，则为调用它的结果 |
| `DO_NOTHING`                                                 | 不采取任何行动。如果你的数据库后端强制执行引用完整性，这将导致一个 `IntegrityError` 除非你手动添加一个 `SQL ON DELETE` 约束条件到数据库字段。 |

## [limit_choices_to](https://docs.djangoproject.com/zh-hans/3.1/ref/models/fields/#django.db.models.ForeignKey.limit_choices_to)

使用 ModelForm 渲染或在管理后台中显示时限制罗列这个字段的条件（默认为查询集中的所有对象）

```python
staff_member = models.ForeignKey(
    User,
    on_delete=models.CASCADE,
    limit_choices_to={'is_staff': True},
)
```

此时，ModelForm 中的相应字段只会列出 `is_staff=True` 的 User 对象。这对 Django 的管理后台可能有用。结合 Python 的 datetime 模块限制选择的日期范围时可以使用可调用对象。例如：

```python
def limit_pub_date_choices():
		return {'pub_date__lte': datetime.date.utcnow()}
limit_choices_to = limit_pub_date_choices
```

## [related_name](https://docs.djangoproject.com/zh-hans/3.1/ref/models/fields/#django.db.models.ForeignKey.related_name)

```python
class User(models.Model):
    name = models.CharField(max_length=20)
    group = models.ForeignKey('Group', on_delete=models.CASCADE)

class Group(models.Model):
    title = models.CharField(max_length=20)
```

```python
>>> User.objects.all()
<QuerySet [<User: Jack>, <User: Tom>, <User: Mike>]>
>>> Group.objects.all()
<QuerySet [<Group: 技术>, <Group: 产品>]>
```

如果一个 User 想要访问其所在的 Group，那么可以通过 ForeignKey group 来进行访问。

```python
>>> user = User.objects.get(id=1)
>>> user.name
'Jack'
>>> user.group
<Group: 技术>
```

但是如果一个 Group 想要访问其所有的 User 怎么办？

1. 可以通过下面的方法：`模型名字小写_set`

```python
>>> group = Group.objects.get(id=1)
>>> group.title
'技术'
>>> group.user_set.all()
<QuerySet [<User: Jack>, <User: Tom>]>
```

2. 给 ForeignKey 增加 related_name 属性，相当于替代 user_set

```python
class User(models.Model):
    name = models.CharField(max_length=20)
    group = models.ForeignKey('Group', on_delete=models.CASCADE, related_name='users')

>>> group = Group.objects.get(id=1)
>>> group.title
'技术'
>>> group.users.all() # 使用 related_name
<QuerySet [<User: Jack>, <User: Tom>]>
```

> 如果你不希望创建一个反向关系，可以将 `related_name` 设置为 `'+'` 或者以 `'+'` 结束
{.is-warning}


## [related_query_name](https://docs.djangoproject.com/zh-hans/3.1/ref/models/fields/#django.db.models.ForeignKey.related_query_name)

目标模型中反向过滤器的名称。

```python
# 规则：ForeignKey 关联字段__关联模型字段
>>> group = Group.objects.filter(user__name='Jack')
>>> group
<QuerySet [<Group: 技术>]>
```

如果设置了 related_name = 'users' 那么上例代码将改成如下：

```python
# 使用 related_name = 'users'
>>> group = Group.objects.filter(users__name='Jack')
>>> group
<QuerySet [<Group: 技术>]>
```

其次，related_name 的值也默认是 related_query_name 的值。但是 related_query_name 也可以将查询的反转名字修改成其他的名字，比如修改为 users2：

```python
# 使用 related_query_name = 'users2'
>>> group = Group.objects.filter(users2__name='Jack')
>>> group
<QuerySet [<Group: 技术>]>
```

## to_field

指定关联对象的字段。默认情况下，Django 使用相关对象的主键。如果引用了其他字段，这个字段必须是 unique=True。

```python
class User(models.Model):
    name = models.CharField(max_length=20)
    # 关联 title 字段
    group = models.ForeignKey('Group', on_delete=models.CASCADE,to_field='title')
    
class Group(models.Model):
		# 被关联的字段必须唯一
    title = models.CharField(max_length=20, unique=True)
```

> 其他更多属性，请参考[官方文档](https://docs.djangoproject.com/zh-hans/3.1/ref/models/fields/#django.db.models.ForeignKey.db_constraint)
{.is-info}

# ManyToManyField

多对多的关系。需要一个位置参数：模型相关的类。但是其背后 Django 会创建了一个中间连接表来表示多对多的关系。

默认情况下，这个表名是使用多对多**字段的名称和包含它的模型的表名**生成的，比如下面的：`app01_article_publications`。由于有些数据库不支持超过一定长度的表名，这些表名将被自动截断，并使用唯一性哈希，例如 `article_publications_9cdf`。

不过也可以使用 `db_table` 选项自定义中间表的名称。

```python
class Publication(models.Model):
    title = models.CharField(max_length=30)

class Article(models.Model):
    headline = models.CharField(max_length=100)
    publications = models.ManyToManyField(Publication)
```

```sql
CREATE TABLE `app01_article` (
  `id` int NOT NULL AUTO_INCREMENT,
  `headline` varchar(100) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8

CREATE TABLE `app01_publication` (
  `id` int NOT NULL AUTO_INCREMENT,
  `title` varchar(30) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8

# 中间表
CREATE TABLE `app01_article_publications` (
  `id` int NOT NULL AUTO_INCREMENT,
  `article_id` int NOT NULL,
  `publication_id` int NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `app01_article_publicatio_article_id_publication_i_7a20a9be_uniq` (`article_id`,`publication_id`),
  KEY `app01_article_public_publication_id_40665d36_fk_app01_pub` (`publication_id`),
  CONSTRAINT `app01_article_public_article_id_b2ab7be5_fk_app01_art` FOREIGN KEY (`article_id`) REFERENCES `app01_article` (`id`),
  CONSTRAINT `app01_article_public_publication_id_40665d36_fk_app01_pub` FOREIGN KEY (`publication_id`) REFERENCES `app01_publication` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8
```

ManyToManyField 所涉及的一些参数用法与 ForeignKey 相同。除了个别特有的参数。

> 注意：使用多对多关系由于无法确定反向查询的名称，两个模型中至少一个设置 `related_name`。如果不希望 Django 不创建反向关系，将 `related_name` 设置为 `'+'`。
{.is-warning}


## [through](https://docs.djangoproject.com/zh-hans/3.1/ref/models/fields/#django.db.models.ManyToManyField.through)

默认情况下，Django 会自动生成一个中间表来管理多对多关系：

- 当源模型和目标模型不同，如下：

```python
class Publication(models.Model):
    title = models.CharField(max_length=30)


class Article(models.Model):
    headline = models.CharField(max_length=100)
    publications = models.ManyToManyField(Publication)

# >>>>>>>>>>>>>  会生成如下字段
++++++++++++++++++++++++++++++++++++++++++++++++
id             int auto_increment primary key,
article_id     int not null,
publication_id int not null,
++++++++++++++++++++++++++++++++++++++++++++++++
```

- 当源模型和目标模型相同，也就是自关联多对多，如下：

```python
class People(models.Model):
    friends = models.ManyToManyField("self")
    
# >>>>>>>>>>>>>  会生成如下字段
++++++++++++++++++++++++++++++++++++++++++++++++   
id             int auto_increment primary key,
from_people_id int not null,
to_people_id   int not null,
++++++++++++++++++++++++++++++++++++++++++++++++
```

当然也可以使用 `through` 参数自定义中间表。其通常目的是为了给中间表添加额外字段而使用。

```python
class Publication(models.Model):
    title = models.CharField(max_length=30)


class Article(models.Model):
    headline = models.CharField(max_length=100)
    # through 指定中间表
    publications = models.ManyToManyField(Publication,through='ArticlePublication')


class ArticlePublication(models.Model):
    article = models.ForeignKey(Article, on_delete=models.CASCADE)
    publication = models.ForeignKey(Publication, on_delete=models.CASCADE)
    # 添加额外字段
    pub_date = models.DateTimeField(default=datetime.now)

    class Meta:
        # 自定义中间表名
        db_table = "article_publication_relationship"
```

## [through_fields](https://docs.djangoproject.com/zh-hans/3.1/ref/models/fields/#django.db.models.ManyToManyField.through_fields)

只有当指定了一个自定义的中间模型时才会使用，Django 通常会决定使用中介模型的哪些字段来自动建立多对多的关系。如下模型：

```python
class Publication(models.Model):
    title = models.CharField(max_length=30)

    def __str__(self):
        return self.title


class Article(models.Model):
    headline = models.CharField(max_length=100)
    publications = models.ManyToManyField(Publication, through='ArticlePublication',
                                          through_fields=('article', 'publication'))

class ArticlePublication(models.Model):
    article = models.ForeignKey(Article, on_delete=models.CASCADE)
    publication = models.ForeignKey(Publication, on_delete=models.CASCADE)
    # 添加额外字段
    pub_date = models.DateTimeField(default=datetime.now)

    class Meta:
        # 自定义中间表名
        db_table = "article_publication_relationship"
```

`through_fields` 接受一个二元元组 `('field1', 'field2')`，其中 `field1` 是定义在 `ManyToManyField` 上的模型（本例中为 `article` ）的外键名称，`field2` 是目标模型（本例中为 `publication`）的外键名称。


> 其他更多属性，请参考[官方文档](https://docs.djangoproject.com/zh-hans/3.1/ref/models/fields/#django.db.models.ManyToManyField.db_table)
{.is-info}

# OneToOneField

一对一的关系。概念上，这类似于 ForeignKey 与 unique=True，但关系的“反向”将直接返回一个单一对象。

最有用的是作为某种方式**扩展**另一个模型的主键。需要一个位置参数：模型将与之相关的类

```python
from django.conf import settings
from django.db import models

class MySpecialUser(models.Model):
    user = models.OneToOneField(
        settings.AUTH_USER_MODEL,
        on_delete=models.CASCADE,
    )
    supervisor = models.OneToOneField(
        settings.AUTH_USER_MODEL,
        on_delete=models.CASCADE,
        related_name='supervisor_of',
    )
```

```python
>>> from django.contrib.auth.models import User
>>> user = User.objects.get(pk=1)
>>> hasattr(user, 'myspecialuser')
True
>>> hasattr(user, 'supervisor_of')
True
```

当访问反向关系时，如果相关表中的条目不存在，就会引发一个 `RelatedObjectDoesNotExist` 异常。这是目标模型的 `Model.DoesNotExist` 异常的一个子类。

`OneToOneField` 接受 `ForeignKey` 接受的所有额外参数，外加一个额外参数：[parent_link](https://docs.djangoproject.com/zh-hans/3.1/ref/models/fields/#django.db.models.OneToOneField.parent_link)
