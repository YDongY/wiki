---
title: 模型字段
description: 
published: true
date: 2021-02-24T09:42:30.352Z
tags: django
editor: markdown
dateCreated: 2021-02-24T02:43:11.974Z
---

# 模型

- 每个模型都是一个 Python 的类，这些类继承 `django.db.models.Model`
- 每个字段都被指定为一个类属性，并且每个属性映射为一个数据库列。

## 字段类型

> [字段类型参考文档](https://docs.djangoproject.com/zh-hans/3.1/ref/models/fields/#model-field-types)
{.is-info}

模型中每一个字段都应该是某个 Field 类的实例， Django 利用这些字段类来实现以下功能：

- 字段类型用以指定数据库数据类型（如：INTEGER, VARCHAR, TEXT）。
- 在渲染表单字段时默认使用的 HTML 视图 (如： `<input type="text">, <select>`)。
- 基本的有效性验证功能，用于 Django 后台和自动生成的表单。

| 字段类型                | 描述                                                         |
| ----------------------- | ------------------------------------------------------------ |
| `AutoField`             | 一个 `IntegerField`，根据可用的 ID 自动递增。默认主键        |
| `BigAutoField`          | 一个 `BigIntegerField`，`1` 到 `9223372036854775807` 的数字  |
| `BigIntegerField`       | 一个 64 位的整数，从 `-9223372036854775808` 到 `9223372036854775807` 的数字。该字段的默认表单部件是一个 `NumberInput`。 |
| `BinaryField`           | 存储原始二进制数据的字段                                     |
| `BooleanField`          | 默认表单部件是 `CheckboxInput`，default未定义时，默认值为 None |
| `CharField`             | 字符串字段                                                   |
| `TextField`             | 大量的文本，默认表单部件是一个 `TextInput`                   |
| `DateField`             | 日期，用一个 `datetime.date` 实例表示                        |
| `DateTimeField`         | 日期和时间，用一个 `datetime.datetime` 实例表示              |
| `DecimalField`          | 固定精度的十进制数                                           |
| `DurationField`         | 用于存储时间段的字段——在 Python 中用 [`timedelta`](https://docs.python.org/3/library/datetime.html#datetime.timedelta) 建模 |
| `EmailField`            | 一个 [`CharField`](https://docs.djangoproject.com/zh-hans/3.1/ref/models/fields/#django.db.models.CharField)，使用 [`EmailValidator`](https://docs.djangoproject.com/zh-hans/3.1/ref/validators/#django.core.validators.EmailValidator) 来检查该值是否为有效的电子邮件地址。 |
| `FileField`             | 文件上传字段                                                 |
| `FilePathField`         | 一个 [`CharField`](https://docs.djangoproject.com/zh-hans/3.1/ref/models/fields/#django.db.models.CharField)，其选择仅限于文件系统中某个目录下的文件名 |
| `FloatField`            | 用一个 `float` 实例表示的浮点数                              |
| `ImageField`            | 上传的对象是有效的图像                                       |
| `IntegerField`          | 整数。从 `-2147483648` 到 `2147483647` 的值                  |
| `GenericIPAddressField` | IPv4 或 IPv6 地址，字符串格式                                |
| `JSONField`             | 一个用于存储 JSON 编码数据的字段                             |
| `SlugField`             | 一个简短的标签，只包含字母、数字、下划线或连字符。它们一般用于 URL 中。 |
| `SmallAutoField`        | 类似 `AutoField`，但是数据范围`1` 到 `32767` 的值            |
| `SmallIntegerField`     | 从 `-32768` 到 `32767` 的值                                  |
| `TimeField`             | 时间，在 Python 中用 `datetime.time` 实例表示                |
| `UUIDField`             | 用于存储通用唯一标识符的字段。使用 Python 的 [`UUID`](https://docs.python.org/3/library/uuid.html#uuid.UUID) 类 |
| `ForeignKey`            | 一个多对一的关系                                             |
| `ManyToManyField`       | 一个多对多的关系                                             |
| `OneToOneField`         | 一对一的关系                                                 |

## 字段选项

> [字段选项参考文档](https://docs.djangoproject.com/zh-hans/3.1/ref/models/fields/#common-model-field-options)
{.is-info}

| 字段选项          | 描述                                                         |
| ----------------- | ------------------------------------------------------------ |
| `null`            | Django 将在数据库中存储空值为 `NULL`。默认为 `False`。对于　CharField 和 TextField　默认为空字符串 |
| `blank`           | `blank=True`，表单验证将允许输入一个空值。默认为 `False` 。  |
| `choices`         | 二元组                                                       |
| `db_column`       | 要使用的数据库列名。如果没有给出列名，Django 将使用字段名。  |
| `db_index`        | 为该字段创建数据库索引。                                     |
| `db_tablespace`   | 如果这个字段有索引，那么要为这个字段的索引使用的 [数据库表空间](https://docs.djangoproject.com/zh-hans/3.1/topics/db/tablespaces/) 的名称。默认是项目的 [`DEFAULT_INDEX_TABLESPACE`](https://docs.djangoproject.com/zh-hans/3.1/ref/settings/#std:setting-DEFAULT_INDEX_TABLESPACE) 设置（如果有设置），或者是模型的 [`db_tablespace`](https://docs.djangoproject.com/zh-hans/3.1/ref/models/options/#django.db.models.Options.db_tablespace) （如果有）。如果后端不支持索引的表空间，则忽略此选项。 |
| `default`         | 默认值。可以是一个值或者是个可调用的对象。如果是个可调用对象，每次实例化模型时都会调用该对象。 |
| `editable`        | 如果是 `False`，该字段将不会在管理或任何其他 [`ModelForm`](https://docs.djangoproject.com/zh-hans/3.1/topics/forms/modelforms/#django.forms.ModelForm) 中显示。在 [模型验证](https://docs.djangoproject.com/zh-hans/3.1/ref/models/instances/#validating-objects) 中也会跳过。默认为 `True`。 |
| `error_messages`  | 覆盖该字段引发的默认消息。传入一个与你想覆盖的错误信息相匹配的键值的字典。 |
| `help_text`       | 额外的“帮助”文本，随表单控件一同显示。即便你的字段未用于表单，它对于生成文档也是很有用的。 |
| `primary_key`     | 如果设置为 `True` ，将该字段设置为该模型的主键。             |
| `unique`          | 如果设置为 `True`，这个字段必须在整个表中保持值唯一。        |
| `unique_for_date` | 将其设置为 [`DateField`](https://docs.djangoproject.com/zh-hans/3.1/ref/models/fields/#django.db.models.DateField) 或 [`DateTimeField`](https://docs.djangoproject.com/zh-hans/3.1/ref/models/fields/#django.db.models.DateTimeField) 的名称，要求该字段的日期字段值是唯一的。 |
| `verbose_name`    | 字段的一个人类可读名称，如果没有给定详细名称，Django 会使用字段的属性名自动创建，并将下划线转换为空格 |
| `validators`      | 要为该字段运行的验证器列表。                                 |

# 特别说明

## null = True 和 blank = True 的区别

null 选项仅仅是数据库层面的设置，然而 blank 是涉及表单验证方面。如果一个字段设置为 blank=True ，在进行表单验证时，接收的数据该字段值允许为空，而设置为 blank=False 时，不允许为空。

## choices 和 枚举

提供了二元组，默认表单小部件是一个选择框，每个二元组的第一个值会储存在数据库中，而第二个值将只会用于在表单中显示。

> 每当 choices 的顺序变动时将会创建新的迁移。
{.is-warning}

```python
YEAR_IN_SCHOOL_CHOICES = [
    ('FR', 'Freshman'),
    ('SO', 'Sophomore'),
    ('JR', 'Junior'),
    ('SR', 'Senior'),
    ('GR', 'Graduate'),
]
```

对于一个模型实例，要获取该字段二元组中相对应的第二个值，使用 `get_FOO_display()` 方法。

枚举类以简洁的方式来定义 choices ：

```python
class Card(models.Model):

    class Suit(models.IntegerChoices):
        DIAMOND = 1
        SPADE = 2
        HEART = 3
        CLUB = 4

    suit = models.IntegerField(choices=Suit.choices)
```

## primary_key

默认情况下， Django 会给每一个模型添加下面的字段：

```python
id = models.AutoField(primary_key=True)
```

这是一个自增的主键。如果自己指定主键，通过在字段上设置参数 primary_key=True，则 Django 不会自动在表（模型）中添加 id 列

> 每个模型都需要拥有一个设置了 primary_key=True 的字段（无论是显式的设置还是 Django 自动设置）。
{.is-info}

## verbose_name

除了 ForeignKey， ManyToManyField 和 OneToOneField，任何字段类型都接收一个可选的位置参数 verbose_name，如果未指定该参数值， Django 会自动使用字段的属性名作为该参数值，并且把下划线转换为空格。

```python
# 备注名为 "person's first name"
first_name = models.CharField("person's first name", max_length=30)

# 备注名为 "first name"
first_name = models.CharField(max_length=30)
```

惯例是不将 verbose_name 的首字母大写，必要时 Djanog 会自动把首字母转换为大写。




