---
title: 模型和数据库
description: 
published: true
date: 2021-02-24T03:17:05.255Z
tags: django
editor: markdown
dateCreated: 2021-02-24T02:43:11.974Z
---

# 模型

- 每个模型都是一个 Python 的类，这些类继承 `django.db.models.Model`
- 每个字段都被指定为一个类属性，并且每个属性映射为一个数据库列。

## 字段类型

> [字段类型参考文档](https://docs.djangoproject.com/zh-hans/3.1/ref/models/fields/#model-field-types)
{.is-info}

模型中每一个字段都应该是某个 Field 类的实例， Django 利用这些字段类来实现以下功能：

- 字段类型用以指定数据库数据类型（如：INTEGER, VARCHAR, TEXT）。
- 在渲染表单字段时默认使用的 HTML 视图 (如： `<input type="text">, <select>`)。
- 基本的有效性验证功能，用于 Django 后台和自动生成的表单。

## 字段选项

> [字段选项参考文档](https://docs.djangoproject.com/zh-hans/3.1/ref/models/fields/#common-model-field-options)
{.is-info}

- **null = True 和 blank = True 的区别**

null 选项仅仅是数据库层面的设置，然而 blank 是涉及表单验证方面。如果一个字段设置为 blank=True ，在进行表单验证时，接收的数据该字段值允许为空，而设置为 blank=False 时，不允许为空。

- **choices**

提供了二元组，默认表单小部件是一个选择框，每个二元组的第一个值会储存在数据库中，而第二个值将只会用于在表单中显示。

> 每当 choices 的顺序变动时将会创建新的迁移。
{.is-warning}

```python
YEAR_IN_SCHOOL_CHOICES = [
    ('FR', 'Freshman'),
    ('SO', 'Sophomore'),
    ('JR', 'Junior'),
    ('SR', 'Senior'),
    ('GR', 'Graduate'),
]
```

对于一个模型实例，要获取该字段二元组中相对应的第二个值，使用 `get_FOO_display()` 方法。

枚举类以简洁的方式来定义 choices ：

```python
from django.db import models

class Runner(models.Model):
    MedalType = models.TextChoices('MedalType', 'GOLD SILVER BRONZE')
    name = models.CharField(max_length=60)
    medal = models.CharField(blank=True, choices=MedalType.choices, max_length=10)
```

- **primary_key**

默认情况下， Django 会给每一个模型添加下面的字段：

```python
id = models.AutoField(primary_key=True)
```

这是一个自增的主键。如果自己指定主键，通过在字段上设置参数 primary_key=True，则 Django 不会自动在表（模型）中添加 id 列

> 每个模型都需要拥有一个设置了 primary_key=True 的字段（无论是显式的设置还是 Django 自动设置）。
{.is-info}

- **verbose_name**

除了 ForeignKey， ManyToManyField 和 OneToOneField，任何字段类型都接收一个可选的位置参数 verbose_name，如果未指定该参数值， Django 会自动使用字段的属性名作为该参数值，并且把下划线转换为空格。

```python
# 备注名为 "person's first name"
first_name = models.CharField("person's first name", max_length=30)

# 备注名为 "first name"
first_name = models.CharField(max_length=30)
```

惯例是不将 verbose_name 的首字母大写，必要时 Djanog 会自动把首字母转换为大写。

# 跨文件模型

关联不同应用的模型，需要在定义模型的文件开头导入需要被关联的模型

```python
from django.db import models
from geography.models import ZipCode

class Restaurant(models.Model):
    # ...
    zip_code = models.ForeignKey(
        ZipCode,
        on_delete=models.SET_NULL,
        blank=True,
        null=True,
    )
```

# 字段命名限制

1. 不能是 Python 保留字
2. 一个字段名称不能包含连续的多个下划线，原因在于 Django 查询语法的工作方式

```python
class Example(models.Model):
    foo__bar = models.IntegerField() # 'foo__bar' has two underscores!
```

3. 字段名不能以下划线结尾，原因同上。

但是，这些限制是可以被解决的，因为字段名没要求和数据库列名一样。查看 db_column 选项。

- **db_colume**

这个字段要使用的数据库列名。如果没有给出列名，Django 将使用字段名。

如果你的数据库列名是 SQL 的保留字，或者包含了 Python 变量名中不允许的字符——特别是连字符——那也没关系。Django 会在幕后引用列名和表名。





