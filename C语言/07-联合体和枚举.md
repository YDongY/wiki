---
title: 07-共用体和枚举
description: 
published: true
date: 2021-03-09T09:00:26.388Z
tags: c
editor: markdown
dateCreated: 2021-02-21T14:39:21.398Z
---

# 共用体(联合体)

- 联合 union 是一个能在同一个存储空间存储不同类型数据的类型
- 联合体所占的内存长度等于其最长成员的长度，也有叫做共用体
- 同一内存段可以用来存放几种不同类型的成员，但每一瞬时只有一种起作用
- 共用体变量中起作用的成员是最后一次存放的成员，在存入一个新的成员后原有的成员的值会被覆盖
- 共用体变量的地址和它的各成员的地址都是同一地址

```c
union Person { // 联合体中的成员，共用同一块内存空间，按照最大的数据类型分配内存空间
    int a;
    short b;
    char c;
};
printf("%lu \n", sizeof(union Person)); // 4

void func(){
    union Person p;
    p.a = 0x01020304;
    p.b = 0x0102;
    p.c = 0x01;

    printf("%#x \n", p.a + p.b + p.c); // 0x1020203
}

------------------------------------------
|  04     |    03    |    02   |    01   |   a = 0x01020304
------------------------------------------
|  02     |    01    |    02   |    01   |   b = 0x00000102
------------------------------------------
|  01     |    01    |    02   |    01   |   c = 0x00000001
------------------------------------------
                    (4 字节)     (2 字节)      (1 字节)
p.a + p.b + p.c = 0x01020101 + 0x00000101 + 0x00000001 = 0x1020203
```

## 位域

```c
union {
  struct {
    char a: 1; // 1 位
    char b: 2; // 2 位
    char c: 1; // 1 位
  } x;
  char y;
} w;

int main(){
    w.y = 1;
    print("%d\n",w.x.a); // -1，%d 对应十进制有符号数的输出
}
```

```c
                  c   b(2bit) a 
---------------------------------
| 0 | 0 | 0 | 0 | 0 | 0 | 0 | 1 |
---------------------------------

w.y = 1 则十六进制存储为 01，也就是 w.x.a 的补码表示为 1 (a 只有 1 位)，所以 a 的值是 -1
```


# 枚举

将变量的值一一列举出来，变量的值只限于列举出来的值的范围内

- 在枚举值表中应列出所有可用值，也称为枚举元素
- 枚举值是常量，不能在程序中用赋值语句再对它赋值。
- 举元素本身由系统定义了一个表示序号的数值从0开始顺序定义为0，1，2 …

```c
enum POKER {
    HONGTAO, // 0
    HEITAO, // 1
    MEIHUA,  // 2
    FANGPIAN //3
};

enum POKER2 {
    HONGTAO2 = 2, // 2
    HEITAO2, // 3
    MEIHUA2,  // 4
    FANGPIAN2 //5
};
```
