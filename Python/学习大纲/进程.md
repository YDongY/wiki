---
title: 17. 进程
description: 
published: true
date: 2021-03-13T02:46:06.136Z
tags: 
editor: markdown
dateCreated: 2021-03-13T02:45:31.494Z
---

# 进程

一个正在运行的程序或者软件就是一个进程，它是操作系统进行资源分配的基本单位

> 一个程序运行后至少有一个进程，一个进程默认有一个线程，进程里面可以创建多个线程，线程是依附在进程里面的，没有进程就没有线程
{.is-warning}

# Process 进程类

- 导包

```python
#导入进程包
import multiprocessing
```

`Process([group [, target [, name [, args [, kwargs]]]]])`

- group：指定进程组，目前只能使用None
- target：执行的目标任务名
- name：进程名字
- args：以元组方式给执行任务传参
- kwargs：以字典方式给执行任务传参

Process 创建的实例对象的常用方法:

- start()：启动子进程实例（创建子进程）
- join()：等待子进程执行结束
- terminate()：不管任务是否完成，立即终止子进程

Process 创建的实例对象的常用属性:

- name：当前进程的别名，默认为 Process-N，N 为从 1 开始递增的整数

案例：

```python
import multiprocessing
import time


# 跳舞任务
def dance():
    for i in range(5):
        print("跳舞中...")
        time.sleep(0.2)


# 唱歌任务
def sing():
    for i in range(5):
        print("唱歌中...")
        time.sleep(0.2)

if __name__ == '__main__':
    # 创建跳舞的子进程
    # group: 表示进程组，目前只能使用None
    # target: 表示执行的目标任务名(函数名、方法名)
    # name: 进程名称, 默认是Process-1, .....
    dance_process = multiprocessing.Process(target=dance, name="myprocess1")
    sing_process = multiprocessing.Process(target=sing)

    # 启动子进程执行对应的任务
    dance_process.start()
    sing_process.start()
```

# 进程编号

通过进程编号可以验证主进程和子进程的关系，可以得知子进程是由那个主进程创建出来的

- os.getpid() 表示获取当前进程编号
- os.getppid() 表示获取当前父进程编号

```python
import multiprocessing
import time
import os


# 跳舞任务
def dance():
    # 获取当前进程的编号
    print("dance:", os.getpid())
    # 获取当前进程
    print("dance:", multiprocessing.current_process())
    # 获取父进程的编号
    print("dance的父进程编号:", os.getppid())
    for i in range(5):
        print("跳舞中...")
        time.sleep(0.2)
        # 扩展:根据进程编号杀死指定进程
        os.kill(os.getpid(), 9)


# 唱歌任务
def sing():
    # 获取当前进程的编号
    print("sing:", os.getpid())
    # 获取当前进程
    print("sing:", multiprocessing.current_process())
    # 获取父进程的编号
    print("sing的父进程编号:", os.getppid())
    for i in range(5):
        print("唱歌中...")
        time.sleep(0.2)


if __name__ == '__main__':

    # 获取当前进程的编号
    print("main:", os.getpid())
    # 获取当前进程
    print("main:", multiprocessing.current_process())
    # 创建跳舞的子进程
    # group: 表示进程组，目前只能使用None
    # target: 表示执行的目标任务名(函数名、方法名)
    # name: 进程名称, 默认是Process-1, .....
    dance_process = multiprocessing.Process(target=dance, name="myprocess1")
    sing_process = multiprocessing.Process(target=sing)

    # 启动子进程执行对应的任务
    dance_process.start()
    sing_process.start()
```

输出：

```python
main: 62248
main: <_MainProcess name='MainProcess' parent=None started>
dance:sing:  6558165582
sing: <Process name='Process-6' parent=62248 started>
sing的父进程编号: 62248

dance:唱歌中...
 <Process name='myprocess1' parent=62248 started>
dance的父进程编号: 62248
跳舞中...
唱歌中...
唱歌中...
唱歌中...
唱歌中...
```

# 进程带参

Process 类执行任务并给任务传参数有两种方式:

- 元组方式传参(args): 元组方式传参一定要和参数的顺序保持一致。
- 字典方式传参(kwargs): 字典方式传参字典中的 key 一定要和参数名保持一致。

```python
import multiprocessing
import time


# 带有参数的任务
def task(count):
    for i in range(count):
        print("任务执行中..")
        time.sleep(0.2)
    else:
        print("任务执行完成")


if __name__ == '__main__':
    # 创建子进程
    # args: 以元组的方式给任务传入参数
    sub_process = multiprocessing.Process(target=task, args=(5,))
    sub_process.start()
```


```python
import multiprocessing
import time


# 带有参数的任务
def task(count):
    for i in range(count):
        print("任务执行中..")
        time.sleep(0.2)
    else:
        print("任务执行完成")


if __name__ == '__main__':
    # 创建子进程

    # kwargs: 表示以字典方式传入参数
    sub_process = multiprocessing.Process(target=task, kwargs={"count": 3})
    sub_process.start()

```

# 进程的注意点

1. 进程之间不共享全局变量
2. 主进程会等待所有的子进程执行结束再结束

